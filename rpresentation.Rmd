---
title: "Good practice for writing R code and R packages"
subtitle: "https://jarbel.github.io/Rgoodpractice/rpresentation.html 
Slides very closely following http://style.tidyverse.org/
"
author: "Julyan Arbel & Alexis Arnaud"
date: "February 8, 2018"
output:
  xaringan::moon_reader:
    includes:
      after_body: include_twitter.html
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.align = "center", dev = "svg")
```

class: center, middle, inverse



# 1. R coding style

---

## Files

---

### Names

```{r, eval=FALSE, echo=TRUE}
# Good
fit_models.R
utility_functions.R

# Bad
fit models.R
foo.r
stuff.r
```

### Structure


```{r, eval=FALSE, echo=TRUE}
# Load data ---------------------------

# Plot data ---------------------------
```


---

## Syntax

---

### Object names

Strive for names that are concise and meaningful.

```{r, eval=FALSE, echo=TRUE}
# Good
day_one
day_1

# Bad
first_day_of_the_month
DayOne
dayone
djm1
```

Avoid using already existing names.

```{r, eval=FALSE, echo=TRUE}
# Bad
T <- FALSE
c <- 10
mean <- function(x) sum(x)
```


---

### Spacing

Any style guide is fundamentally opinionated...

```{r, eval=FALSE, echo=TRUE}
# Good Hadley
average <- mean((feet / 12) + inches, na.rm = TRUE)
sqrt(x^2 + y^2)
x <- 1:10
base::get

# Good Alexis
average <- mean(
    ( feet / 12 ) + inches 
  , na.rm = TRUE
  )
sqrt( x^2 + y^2 )
x <- 1:10
base::get

# Bad
average<-mean(feet/12 + inches,na.rm=TRUE)
sqrt(x ^ 2 + y ^ 2)
x <- 1 : 10
base :: get
```

---

### Indenting

```{r, eval=FALSE, echo=TRUE}
# Good
if (y < 0 && debug) {
  message("y is negative")
}

# Bad
if (y < 0 && debug)
message("Y is negative")
```

---

### Long lines

Strive to limit your code to 80 characters per line.

```{r, eval=FALSE, echo=TRUE}
# Good
do_something_very_complicated(
  something = "that",
  requires = many,
  arguments = "some of which may be long"
)

# Bad
do_something_very_complicated("that", requires, many, arguments,
                              "some of which may be long"
                              )
```

---

### Assignment

```{r, eval=FALSE, echo=TRUE}
# Good
x <- 5

# Bad
x = 5 
```

---

## lintr and styler package


```{r, eval=FALSE, echo=TRUE}
install.packages(c("lintr", "styler"))
library("lintr")
library("styler")
```

---

### lintr package

lintr can be used o a source file, eg `bad_style.R` being the following source:

```{r, eval=FALSE, echo=TRUE}
# Spacing 
average<-mean(feet/12 + inches,na.rm=TRUE)
sqrt(x ^ 2 + y ^ 2)
x <- 1 : 10
base :: get

# Indenting
if (y < 0 && debug)
message("Y is negative")

# Assignment
x = 5
```

Then run

```{r, eval=FALSE, echo=TRUE}
lint("bad_style.R")
```


---

### lintr package

```{r, out.width="90%"}
knitr::include_graphics("https://camo.githubusercontent.com/20dbcc29a25f1e86dcde02d2056508c322f6ae05/687474703a2f2f692e696d6775722e636f6d2f50494b6e70626e2e706e67")
```


---

### styler package

```{r, out.width="100%"}
knitr::include_graphics("https://raw.githubusercontent.com/lorenzwalthert/some_raw_data/master/styler_0.1.gif")
```

---

### styler package

You can use the `style_text()` function as follows

```{r, eval=FALSE, echo=TRUE}
ugly_code <- "a<-function( x){1+1}           "
style_text(ugly_code)
```


```{r, eval=FALSE, echo=TRUE}
# Bad
a<-function( x){1+1}

# Good
a <- function(x) {
  1 + 1
}
```


---

### styler package

As well as the following variants of `style_text()`:

* `style_file()` styles .R and/or .Rmd files.
* `style_dir()` styles all .R files in a directory.
* `style_pkg()` styles the source files of an R package.
* RStudio Addins for styling the active file, styling the current package and styling the highlighted code region.

---

## References

To complete:
* http://style.tidyverse.org/
* https://cran.r-project.org/web/packages/rockchalk/vignettes/Rstyle.pdf
* https://journal.r-project.org/archive/2012-2/RJournal_2012-2_Baaaath.pdf
* https://cran.r-project.org/doc/manuals/R-ints.html
* https://google.github.io/styleguide/Rguide.xml
* https://www.r-project.org/conferences/useR-2004/Keynotes/Maechler.pdf
* https://stat.ethz.ch/Teaching/maechler/R/useR_2014/Maechler-2014-pr.pdf
* http://andrewgelman.com/2007/09/18/style_guide_for/
* http://blog.jom.link/ten_rules_reproductible_research.html

---

class: center, middle, inverse

# 2. Create R packages

---



---

## References

To complete:
* https://cran.r-project.org/doc/contrib/Leisch-CreatingPackages.pdf
* http://kbroman.org/pkg_primer/
* https://github.com/klutometis/roxygen
* http://r-pkgs.had.co.nz/
* https://support.rstudio.com/hc/en-us/articles/200486488-Developing-Packages-with-RStudio
* https://www.r-bloggers.com/how-to-write-and-debug-an-r-function/
* https://nicercode.github.io/guides/functions/
* https://swcarpentry.github.io/r-novice-inflammation/06-best-practices-R/

---

class: center, middle, inverse

# Thanks!

<br>

Presentation available at

https://jarbel.github.io/Rgoodpractice/rpresentation.html

<br>

Twitter: [@julyanarbel](https://twitter.com/julyanarbel)

GitHub: [@jarbel](https://github.com/jarbel)

.footnote[Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).]
